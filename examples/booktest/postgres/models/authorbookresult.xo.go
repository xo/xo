// Package models contains the types for schema 'public'.
package models

// Code generated by xo. DO NOT EDIT.

// AuthorBookResult is the result of a search.
type AuthorBookResult struct {
	AuthorID   int         // author_id
	AuthorName string      // author_name
	BookID     int         // book_id
	BookIsbn   string      // book_isbn
	BookTitle  string      // book_title
	BookTags   StringSlice // book_tags
}

// AuthorBookResultsByTags runs a custom query, returning results as AuthorBookResult.
func AuthorBookResultsByTags(db XODB, tags StringSlice) ([]*AuthorBookResult, error) {
	var err error

	// sql query
	const sqlstr = `SELECT ` +
		`a.author_id, ` + // ::integer AS author_id
		`a.name, ` + // ::text AS author_name
		`b.book_id, ` + // ::integer AS book_id
		`b.isbn, ` + // ::text AS book_isbn
		`b.title, ` + // ::text AS book_title
		`b.tags::text[] AS book_tags ` +
		`FROM books b ` +
		`JOIN authors a ON a.author_id = b.author_id ` +
		`WHERE b.tags && $1::varchar[]`

	// run query
	XOLog(sqlstr, tags)
	q, err := db.Query(sqlstr, tags)
	if err != nil {
		return nil, err
	}
	defer q.Close()

	// load results
	res := []*AuthorBookResult{}
	for q.Next() {
		abr := AuthorBookResult{}

		// scan
		err = q.Scan(&abr.AuthorID, &abr.AuthorName, &abr.BookID, &abr.BookIsbn, &abr.BookTitle, &abr.BookTags)
		if err != nil {
			return nil, err
		}

		res = append(res, &abr)
	}

	return res, nil
}
